<!DOCTYPE html>
<html>
<head>
<title>SHOOTER</title>
<link rel="stylesheet" href="shooter.css">
</head>
<body onclick="shot()">
    <div class="object" id="ally" onclick="targetShot(this)"></div>
    <div class="object" id="enemy" onclick="targetShot(this)"></div>
    <div class="object" id="enemy-gold" onclick="targetShot(this)"></div>
    <div id="upgrade-container">
       <div class="upgrade-button" id="multiplyer">get more points/time from enemies</div>
        <div class="upgrade-button" id="ammo-count">+1 bullet</div>
        <div class="upgrade-button" id="reload-time">shorter reload time</div> 
    </div>
    
    <div id="stats">
        <div id="score">score: 0</div>
        <div id="ammo"></div>    
    </div>
    <div id="reload-message">RELOADING...</div>
    <script>
        //variables
        var w = window.innerWidth;
        var h = window.innerHeight;
        var score = 0;
        var isReloading = false;
        var reloadTime = 2000;
        var setAmmo = 3;
        var ammo = 3;
        var intervals = {};
        var isPaused = false;

        var ally = document.getElementById("ally");
        var enemy = document.getElementById("enemy");
        var enemyGold = document.getElementById("enemy-gold");
        var reloadMessage = document.getElementById("reload-message");
        var element = document.documentElement;

        function targetShot(element){
            if (isReloading || isPaused){
                return;
            } else if (element.id === "enemy") {
                score += 5;
            } else if (element.id === "enemy-gold") {
                score += 15;
            } else if (element.id === "ally") {
                score -= 5;
            }
            document.getElementById("score").innerHTML = "score: " + score;
            spawn(element);
        }
        function reload() {
            isReloading = true;
            reloadMessage.style.display = "block";
            setTimeout(() => {
                reloadMessage.style.display = "none";
                ammo = setAmmo;
                document.getElementById("ammo").innerHTML = "ammo: " + ammo;
                isReloading = false;
            }, reloadTime);
        }
        function shot(){
            if (!isReloading && !isPaused && ammo > 0){
                new Audio("gunshot.mp3").play();
                ammo--;
                document.getElementById("ammo").innerHTML = "ammo: " + ammo;

                if (ammo === 0){
                    reload();
                }
            }
        }

        function movement(element) {
            if (!element.dx) {
                element.dx = 1; // Done only once
            }
            if (!element.dy) {
                element.dy = 1; // Done only once
            }

            var elementId = element.id; // Unique ID for the element
            intervals[elementId] = setInterval(function () {
                var x = parseFloat(element.style.left);
                var y = parseFloat(element.style.top);
                var elementWidth = element.offsetWidth;
                var elementHeight = element.offsetHeight;

                if (x + elementWidth > w || x < 0) element.dx = -element.dx;
                if (y + elementHeight > h || y < 0) element.dy = -element.dy;

                element.style.left = x + element.dx + "px";
                element.style.top = y + element.dy + "px";
            }, 1);
        }

        function stopAllMovement() {
            for (let ID in intervals) {
                clearInterval(intervals[ID]); // Stop all intervals
            }
            isPaused = true;
            document.getElementById("multiplyer").style.display = "flex";
            document.getElementById("ammo-count").style.display = "flex";
            document.getElementById("reload-time").style.display = "flex";
            document.getElementById("upgrade-container").style.display = "flex";
            document.getElementById("stats").style.display = "none";
        }
        function resumeAllMovement() {
            movement(ally);
                    movement(enemy);
                    movement(enemyGold);
                    document.getElementById("multiplyer").style.display = "none";
                    document.getElementById("ammo-count").style.display = "none";
                    document.getElementById("reload-time").style.display = "none";
                    document.getElementById("upgrade-container").style.display = "none";
                    document.getElementById("stats").style.display = "block";
                    isPaused = false
        }

        function spawn(element){
            var elementWidth = element.offsetWidth;
            element.style.left = Math.floor(Math.random() * (w - elementWidth)) + "px";
            element.style.top = Math.floor(Math.random() * (h - elementWidth)) + "px";
        }

        document.addEventListener('keydown', function(event) {
            if (event.key === 'f' || event.key === 'F') { //Fullscreen
                if (element.requestFullscreen) {
                element.requestFullscreen();
            } else if (element.mozRequestFullScreen) { // Firefox
                element.mozRequestFullScreen();
            } else if (element.webkitRequestFullscreen) { // Chrome, Safari and Opera
                element.webkitRequestFullscreen();
            } else if (element.msRequestFullscreen) { // IE/Edge
                element.msRequestFullscreen();
            }
            }
            else if (event.key === 'p' || event.key === 'P'){ //Pause
                if (!isPaused){
                    stopAllMovement();
                }
                else{
                    resumeAllMovement();
                }
            }
            else if (event.key === 'r' || event.key === 'R'){
                reload();
            }
        });

        spawn(ally);
        spawn(enemy);
        spawn(enemyGold);
        movement(ally);
        movement(enemy);
        movement(enemyGold);
        document.getElementById("ammo").innerHTML = "ammo: " + ammo;

    </script>
</body>
</html>
